---
title: "EDA of electricity time series"
output: html_notebook
---

```{r libraries, message=FALSE, warning=FALSE, error=FALSE}
# Load libraries
library(RCurl)
library(tidyverse)
library(magrittr)
library(plotly)
library(imputeTS)
library(lubridate)
```

```{r echo=TRUE}
# Load data (relative file path) and view contents
df <- read.csv("../data/energy_dataset.csv")
head(df)
```

```{r}
dim(df) # Number of rows and columns
```


```{r}
summary(df) # Distribution and missingness for each variable
```
 

## Missing data

There are six columns that contain no values (all NAs or zeroes) which are removed here.

```{r}
df_v2 <- df |> 
  select(-c(generation.fossil.coal.derived.gas,
            generation.fossil.oil.shale,
            generation.fossil.peat,
            generation.geothermal,
            generation.marine,
            generation.hydro.pumped.storage.aggregated,
            generation.wind.offshore,
            forecast.wind.offshore.eday.ahead))
```


```{r}
colSums(is.na(df_v2)) # Number of missing values for each remaining variable
```
16 out of 21 of the remaining variables each have a maximum of 36 missing values. Looking at where these occur, we see that most missing values occur across variables. Specifically, 90% of the missing values are of these occur over only 18 rows. The remaining 10% are spread across 28 rows.

```{r}
# Rows where data is missing
df_v2[!complete.cases(df_v2),]

# Number of NAs per row
missing_per_row <- rowSums(is.na(df_v2[!complete.cases(df_v2),]))
missing_per_row
sum(missing_per_row > 1)
sum(missing_per_row[missing_per_row > 1])/sum(missing_per_row)
```
## Plotting

```{r}
# Formatting
data$time <- as.POSIXlt(data$time)

gen_data <- data %>%
  select(1, 1:21) %>%
  pivot_longer(generation.biomass:generation.wind.onshore, names_to = "type")

gen_data$type <- as.factor(gen_data$type)

# Plot distribution of generation missingness 
ggplot_na_distribution(x=gen_data$value, y=gen_data$time)
```


```{r}


generation_plot <- ggplot() +
  geom_bar(data = gen_data, stat = "identity", aes(x = time, y = value, fill = type)) +
  geom_line(data = data, aes(x = time, y = total.load.actual)) +
  theme_minimal() +
  guides(fill = FALSE) 

generation_plot
```

```{r}
gen_data$year <- year(gen_data$time)
gen_data$month <- month(gen_data$time)
gen_data$day <- day(gen_data$time)
gen_data$hour <- hour(gen_data$time)

hourly_generation_plot_by_year <- gen_data %>%
  ggplot(aes(x = hour, y = value, fill = type)) +
  geom_bar(stat = "identity") + theme(legend.position = "none") 

hourly_generation_plot_by_year
```

```{r}
daily_generation_plot_by_year <- gen_data %>%
  ggplot(aes(x = day, y = value, fill = type)) +
  geom_bar(stat = "identity") +
  facet_wrap(~year) + theme(legend.position = "none") 

daily_generation_plot_by_year
```

```{r}
monthly_generation_plot <- gen_data %>%
  ggplot(aes(x = month, y = value, fill = type)) +
  geom_bar(stat = "identity") +
  facet_wrap(~year)

monthly_generation_plot
```




```{r}
price_vs_forecast <- data %>%
  select(., c(time, price.actual, price.day.ahead)) 

price_vs_forecast$time <- ymd(price_vs_forecast$time)
price_vs_forecast$difference <- price_vs_forecast$price.day.ahead - price_vs_forecast$price.actual

price_vs_forecast %>%
  ggplot() +
  geom_line(aes(x=time, y=difference))
```
```{r}
load_vs_forecast <- data %>%
  select(., c(time, total.load.actual, total.load.forecast))

load_vs_forecast$time <- ymd(load_vs_forecast$time)
load_vs_forecast$difference <- load_vs_forecast$total.load.forecast - load_vs_forecast$total.load.actual

load_vs_forecast %>%
  ggplot() +
  geom_line(aes(x=time, y=difference))
```
```

